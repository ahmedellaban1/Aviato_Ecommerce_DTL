{% extends "base_register.html" %}
{% load static %}

{% block container %}
  {% if user.is_active %}
    <script>
        window.location.href = "{% url 'login' %}";
    </script>
  {% endif %}

  {% if error_message %}
    <p class="text-danger">{{ error_message }}</p>
  {% endif %}

  <h2 class="text-center">You are about to start shopping</h2>
  <h4 class="text-center">Enter the OTP you received in your mail</h4>

  <form method="post">
    {% csrf_token %}
    <br>
    <input type="text" class="form-control" name="otp" maxlength="6" placeholder="OTP is a 6-digit number" id="otp-input" required>
    <br>
    <input class="btn btn-main text-center w-100" type="submit" value="Verify OTP" id="verify-btn">
    <input type="hidden" name="next" value="{% url 'login' %}">
  </form>

<script>
  const otpInput = document.getElementById("otp-input");
  const verifyBtn = document.getElementById("verify-btn");

  otpInput.addEventListener("input", function () {
    // Only digits
    this.value = this.value.replace(/[^0-9]/g, "");

    // Max length 6
    if (this.value.length > 6) {
      this.value = this.value.substring(0, 6);
    }

    // Enable/disable button
    verifyBtn.disabled = this.value.length !== 6;
  });
</script>
{% endblock %}
